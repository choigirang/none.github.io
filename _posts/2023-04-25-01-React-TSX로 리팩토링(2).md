---
title: "React 48장 - TSX로 리팩토링하기 (2)"
excerpt: ""

categories: React
tags: [React, 리액트, 쿼리, query]

toc: true
toc_sticky: true

date: 2023-03-28
last_modified_at: 2023-03-28
---

# React

[TO-Do List 링크](https://github.com/choigirang/mini-todo-list-second){:target="\_blank"}

## 리팩토링

너무 오랜만에 남기는 거라 작성해야 될 게 많이 남았지만 현재 작성하고 있는 부분까지만 작성해본다.

### useQuery 사용하기

#### Login.tsx

1.  `npm install react-query`를 설치한다.
    1. 타입스크립트의 타입을 위해 `npm install @types/react-query` 또한 설치한다.
2.  컴포넌트에서 Query 사용을 위해 최상위 컴포넌트인 App.tsx에서 `QueryClient`를 선언 후 컴포넌트를 감싸준다.

    ```jsx
    const queryClient = new QueryClient();

    return <QueryClientProvider client={queryClient}></QueryClientProvider>;
    ```

3.  쿼리를 추적하기 위해 `ReactQueryDevtools` 또한 하단에 작성한다.

    ```jsx
    import { ReactQueryDevtools } from "react-query/devtools";

    return(
    <ReactQueryDevtools></ReactQueryDevtools>;
    )
    ```

4.  기존에 axios를 사용하여 작성된 코드를 `useQuery`로 변경한다.

    ```JSX
    // 기존 코드
    const loginApi = () => {
    axios.get<LoginUser[]>("http://localhost:4000/login").then((res) => {
        const matchedUser = res.data.find(
        (user) => user.id === id && user.pass === pw
        );
        if (matchedUser) {
        // 로그인 성공 처리
        setLoginValue(!loginValue);
        setMessage(true);
        } else {
        // 로그인 실패 처리
        setMessage(false);
        }
    });}
    ```

    ```JSX
    async function login() {

    const res = await axios.get("http://localhost:4000/login");
    return res;
    }

    const { data, isLoading, isError, error } = useQuery("get", () => login(), {
        refetchOnWindowFocus: false,
    });

    const loginApi = async () => {
        const response = await axios.get("http://localhost:4000/login");
        const matchedUser = response.data.find(
            (user: LoginUser) => user.id === id && user.pw === pw
        );
        if (matchedUser) {
        // 로그인 성공 처리
        setLoginValue(!loginValue);
        setMessage(true);
        } else {
        // 로그인 실패 처리
        setMessage(false);
        }
    };
    ```

#### SignPage.tsx
