---
title: "Next.Js 14장 - 만들면서 배우기 (10)"
excerpt: "이미지를 효과적으로 활용하기"

categories: Next
tags: [Next, React, 리액트, nextjs, typescript, props]

toc: true
toc_sticky: true

date: 2023-09-08
last_modified_at: 2023-09-08
---

# Next

## Image 컴포넌트

- next/image 라는 컴포넌트가 있다.
- 이전에도 한 번씩 사용해왔는데, 그저 **이미지를 최적화 해준다.** 만 알고 있고 어떤 게 어떻게 동작하는지에 대해 전혀 모르고 있었다.
- 이번에 사용할 때도, 나는 이미지를 업로드 시킨 `width, height` 값을 그대로 사용하고 싶은데, 자꾸 나에게 정해진 `width, height` 값을 요구했다.
  - 부여하지 않을 시 넘어가지 않았다...
- 그래서 `Image` 컴포넌트에 대해 더 알고 사용해야겠다는 필요성을 느꼈고 찾아보니, 내가 생각했던 것보다 배워야할 게 많다는 것을 느껴 정리해본다.

### 장점

- 공식 문서에서 `<Image>`는 이렇게 표현하고 있다.

1. `<img>` 태그에서 확장되어 최적화를 위한 Next.js의 이미지 컴포넌트이다.
2. 각 각의 디바이스에 맞는 적절한 이미지 사이즈를 지정할 수 있다.
3. **누적 레이아웃 이동?**이 발생하지 않도록 안정성을 보장한다.
4. 뷰포트에 들어갈 때만 이미지가 로드된다.
5. `remote`서버 (클라우드, CMS 등)에 저장된 이미지도 리사이징이 가능하다.

### `<img>` 태그의 단점

<img src="https://miro.medium.com/v2/resize:fit:720/0*8BnXSsqOUWfdJ26k"/>

- 예를 들어, 모바일 뷰에서 렌더링되는 이미지 크기가 360x240px 이지만, 브라우저에서 서버로부터 받는 이미지의 크기는 이미지의 원본 크기인 2400x1598px의 이미지를 받게 된다.
- WebP(구글 이미지 포맷)과 같은 현대 이미지 포맷을 적용하지 않기에 브라우저에서 기존 이미지 포맷으로 대체해야 한다.

#### 그렇기 때문에 Image가 효율적

- Image 컴포넌트가 갖고 있는 이점과 HTML img 태그가 갖고 있는 단점으로 우리는 next/Image 컴포넌트를 쓸 이유가 충분히 생겼다고 할 수 있다.

### 사용법

- 이미지 컴포넌트에는 여러가지 필수 속성이 존재한다.
- 나와 같은 경우에도 필수 속성인 `width, height` 값에 막혀있었는데, 이는 `local`, `remote` 저장소의 차이로도 나뉜다.
- 우선 프로젝트 내에 저장된 **로컬 이미지를 사용하는 경우, 이미지의 넓이와 높이값을 자동으로 계산**해줄 수 있지만, **원격 저장소의 이미지에는 Next.js가 빌드 시점에 파일에 접근할 수 없기 때문에 넓이와 높이값을 필수**적으로 지정해줘야 한다.
- `next.config.js` 파일에서 이미지 컴포넌트에 관한 설정들을 적용할 수도 있다.

#### 설정

```js
// next.config.js

module.exports = {
  images: {
    domain: ["cloud.here.com"],
    loader: "imgix",
    path: "https://example.com/myaccount/",
    deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],
    imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],
  },
};
```

- domain : 원격 저장소에서 이미지를 가져오는 URL 주소를 지정한다.
  - **링크의 이미지에 대해 최적화를 지원하게 된다.**
- loader : Next.js는 기본적으로 이미지 로더를 제공하는데, `imgix, cloudinary, akamai` 등 로더를 설정할 수 있다.
- caching: default 이미지 로더를 사용할 때, 제공된 최적화 이미지가 캐싱되는 것에 관련된 설정이다.
- deviceSizes : 디바이스 사이즈 별 설정이다.
  - **layout 프로퍼티가 reponse, fill 일 때 적용된다.**
- imageSizes : 디바이스 사이즈 배열과 연결되어 이미지 srcset을 생성하는 배열로, 이 값들은 디바이스 사이즈의 최소값보다 작아야 한다.
- 이 외에도, 지원 이미지 포맷, 캐싱 이미지 수명, 정적 이미지 비활성화, svg 포맷 지원 등의 옵션을 설정할 수 있다.

#### 속성

- 이미지 컴포넌트가 요구하는 추가적인 설정을 위한 속성값들이 존재한다.

```jsx
<Image
  // Required Props
  src="https://cdn.com/image.webp"
  alt="next image"
  width={40}
  height={40}
  // Optional Props
  layout="responsive"
  loader={exampleLoader}
  sizes="320 640 750"
  quality={100}
  priority
  placeholder="blur"
  blurDataUrl="../public/blur.jpg"
  // Advanced Props
  objectFit="contain"
  objectPosition="top right"
  loading="lazy"
  onLoadingComplete={(imageDimension) => {
    console.log(imageDimension);
  }}
  lazyBoundary="200px"
  unoptimized
/>
```

**필수**

- src : 이미지 출처값으로 프로젝트 디렉토리 내 정적경로 혹은 외부 도메인의 URL(config 설정 필요)을 넘겨 줘야 한다.
- width & height : 이미지의 크기, 단위를 제외한 정수값을 전달해야 하며, 정적 이미지 혹은 **`layout="fill"`**이 아닌 경우 요구된다.

**선택**

- layout : 뷰포트의 크기가 변경될 떄 이미지 레이아웃 동작을 설정한다.
  - intrinsic : 기본값으로 이미지 사이즈보다 작은 뷰포트에선 크기가 줄어들지만, 큰 뷰포트에선 본래 크기를 유지한다.
  - fixed : 정확한 넓이와 높이값에 맞춘다.
  - responsive : 이미지가 작은 뷰포트에선 크기가 줄어들고, 큰 뷰포트에선 넓이와 높이가 맞춰서 늘어난다.(부모 요소가 `display : block` 이어야 한다.)
  - fill : 부모 요소의 크기에 맞춰 넓이와 높이가 늘어나며, `objectFit` 속성과 함께 사용된다. (부모 요소가 `position : relative` 이어야 한다.)
- loader : 이미지 URL을 반환하는 함수로, 사용자 지정 함수를 사용하거나 기본적으로는 next.config.js의 loader를 오버라이드 한다.
  - src, width, quality를 파라미터로 받아 이미지 소스의 URL을 반환한다.
- sizes : breakpoint에서 어느 너비를 가질지 설정한다.
  - layout(responsive, fill)의 경우 뷰포트보다 작은 이미지는 기본 넓이가 100vw이므로 이 크기를 지정하는 것이 중요하다.
  - intrinsic, fixed 는 넓이의 상한선이 제약되어 있어 이 속성을 적용하지 않는다.
- quality : 기본값은 75로, 1 ~ 100 까지의 정수를 부여하며 이미지의 품질을 나타낸다.
- priority : 설정된 이미지는 높은 우선순위를 가져 preload 된다.
  - 설정 시 lazy loading은 자동으로 비활성화 되고, 상단에 보여지는 이미지들에 주로 사용되며, LCP(Largest Contentful Paint) 요소로 감지되는 이미지에 사용해야 한다.
- placeholder : 이미지가 로드되는 동안 보여지는 fallback을 설정한다.
  - empty, blur로 설정할 수 있으며, blur인 경우 blurDataURL이 자동으로 채워지지만, 동적 이미지의 경우 전달한 이미지가 fallback으로 사용된다.
  - 해봐야 알겠다.

**추가**

- ojbectFit
- objectPosition
- loading
- onLoadingComplete
- lazyBoundary
- unoptimized
- 등 의 속성들이 있지만 다음에 정리하도록 하겠다.
