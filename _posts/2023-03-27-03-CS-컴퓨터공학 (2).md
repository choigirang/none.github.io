---
title: "CS 17장 - 컴퓨터 공학(2)"
excerpt: "프로세스와 스레드"

categories: CS
tags: [기술면접, 싱글스레드, 운영체제, 스레드, 멀티스레드, 프로세스]

toc: true
toc_sticky: true

date: 2023-03-27
last_modified_at: 2023-03-27
---

# CS

## 운영체제

- 각각의 하드웨어를 연결했다고 해서 원하는 프로그램을 수행할 수 있는 것은 아니다.
- 하드웨어는 단지 특정 기능을 수행 할 뿐인데, 컴퓨터라는 하드웨어 상에 프로그램들이 동작되려면 적절하게 데이터를 주고 받으며 논리적인 일들을 해야 한다.
- 하드웨어에게 일을 시키는 주체가 운영체제이다.

### 운영체제의 목적 및 기능

- 프로세서, 기억장치, 입출력장치, 파일 및 정보 등의 자원을 관리한다.
- 자원을 효율적으로 관리하기 위해 자원의 스케쥴링 기능을 제공한다.
- 사용자와 시스템 간의 편리한 인터페이스를 제공한다.
- 시스템의 각종 하드웨어와 네트워크를 관리하고 제어한다.

### 운영 체제의 시스템 자원 관리

- 운영체제가 없다면, 응용 프로그램이 실행될 수 없다.
- 응용 프로그램은 컴퓨터를 이용해 다양한 작업을 하는 것이 목적이고, 하드웨어에게 일을 시킬 수 있도록 도와준다.
- 하드웨어를 구성하는 일을 하는 CPU, 자료를 저장하는 RAM, 디스크 등의 시스템 자원을 관리하는 주체가 바로 운영체제이다.
  - 프로세스 관리 CPU
  - 메모리 관리
  - I/O 입출력 관리

#### 응용 프로그램 관리

- 모든 응용 프로그램이 시스템의 자원을 마음대로 사용한다면 해커에 의한 공격에 무방비한 상태가 된다.
- 악의적인 목적을 가진 프로그램이 민감한 정보에 접근하거나, 내 스마트폰의 특정 앱이 카메라를 아무 때나 실행하는 등의 문제가 발생한다.
- 따라서 응용 프로그램은 권한에 대한 관리가 필요한데, 응용 프로그램이 실행되고 시스템 자원을 사용할 수 있도록 권한과 사용자를 관리한다.
- 응용 프로그램이 운영체제를 통해 컴퓨터에게 일을 시키려면, 컴퓨터를 조작할 수 있는 권한을 운영체제로부터 부여받아야 한다.
- 권한을 부여받고 난 후에는 운영체제가 제공하는 기능을 이용할 수 있다.
- 응용 프로그램이 운영체제와 소통하기 위해서는 운영체제가 응용 프로그램을 위해 인터페이스를 제공해야 한다.
- 응용 프로그램이 시스템 자원을 사용할 수 있도록 운영체제 차원에서 다양한 함수를 제공하는 것을 시스템 콜이라고 부른다.
- 만약 프로그램이 프린터를 사용하기 위해서는 운영체제로부터 프린터 사용에 대한 권한을 부여받아야 하며, 프린터 사용에 대한 권한을 획득한 후에는 프린터를 사용할 떄 필요한 API를 호출해야 한다.
- API는 시스템 콜로 이루어져 있다.

## 프로세스

- 프로그램이 실행 중인 상태로 특정 메모리 공간에 프로그램의 코드가 적재되고 CPU가 해당 명령어를 하나씩 수행하고 있는 상태를 의미한다.
- 운영 체제에서는 프로세스를 사용하여 프로그램을 수행하게 되는데 실행 중인 하나의 애플리케이션을 프로세스라고 부른다.
- 사용자가 애플리케이션을 실행하면 운영체제로부터 실행에 필요한 메모리를 할당받아 애플리케이션의 코드를 실행한다.
- 이때 실행되는 애플리케이션을 프로세스라고 부르며,만약 브라우저를 두 개 실행하면, 두 개의 프로세스가 생성되며 하나의 애플리케이션은 여러 프로세스를 만들기도 한다.

### 프로세스 구성 요소

- 프로세스의 구조체에는 프로세스마다 독립적으로 관리해야 하는 유저 메모리 영역이나 프로세스가 사용하는 각종 객체들의 포인터를 관리하는 핸들 테이블을 가지고 있다.
  - 유저 메모리 영역 관리
    - 프로세스 별로 독립된 영역을 가지게 되는 곳은 유저 메모리 공간이다.
    - 커널 메모리 공간의 경우 모든 프로세스가 공유하여 사용하고 있다.
    - 프로세스 별로 독립적인 유저 메모리 영역을 관리하기 위해 VAD라는 관리 테이블이 존재한다.
  - 핸들 테이블
    - 프로세스에서 사용하는 모든 핸들에 대한 커널 객체 포인터 정보를 배열 형태로 가지고 있는 공간이다.
    - 프로세스가 종료하게 될 때 이 테이블의 정보를 참고하여 이 프로세서에서 사용하고 있는 모든 커널 객체를 자동으로 반환한다.
  - 독립적인 메모리 공간
    - 프로세스 단위로 관리되는 자원 중 가장 중요한 구별점은 가상 메모리이다.
    - 페이징 기법을 이용하여 프로세스마다 별도의 고유한 메모리를 사용할 수 있게 하고 있다.

### 프로세스 특징

- 자원 소유의 단위
  - 각각의 프로세스는 자신의 실행 이미지 로드와 실행에 필요한 추가적인 메모리 공간을 가지고 있어야 한다.
  - 각 프로세스마다 구별되어야 하며 해당 프로세스가 접근하고자 하는 파일, I/O장치들에 대해서 프로세서 단위로 할당 받아 관리되어야 한다.
- 디스패칭의 단위
  - 프로세스는 하나의 프로그램이 운영체제로부터 CPU의 자원을 일정 기간 동안 할당 받아 명령어를 실행하는 것이며, 운영체재는 여러 개의 프로세스가 병렬적으로 실행되게 하기 위해 CPU의 사용 시간을 각각의 프로세스에 골고루 나누어 주어야 한다.
  - 하나의 프로세스에서 여러 개의 디스패칭 단위가 실행될 수 있도록 하며, 이러한 디스패칭 단위를 스레드라 부른다.

### 프로세스 상태

- 실행 : 프로세스가 프로세서를 차지하여 서비스를 받고 있는 상태를 말한다.
- 준비 : 실행될 수 있도록 준비되는 상태를 말한다.
- 대기 : CPU의 사용이 아니라 입출력의 사건을 기다리는 상태를 말한다.

### 프로세서 vs 프로세스

#### 프로세서

- 하드웨어적인 측면
  - 컴퓨터 내에서 프로그램을 수행하는 하드뤠어 유닛으로, 중앙처리장치를 의미하며 적어도 하나 이상의 ALU와 레지스터를 내장하고 있다.
- 소프트웨어적인 측면
  - 데이터 포맷을 변환하는 역할을 수행하는 데이터 처리 시스템을 의미한다.
  - 워드프로세서나 컴파일러 등이 여기에 속한다.

#### 프로세스

- 특정 목적을 수행하기 위해 나열된 작업의 목록을 의미한다.
- 메모리에 적재 되어 프로세서에 의해 실행 중인 프로그램을 말한다.

## 스레드

![image](https://user-images.githubusercontent.com/118104644/227859727-917035d9-6681-4881-b74d-984c994d5bfe.png){:.center}

- 명령어가 CPU를 통해서 수행되는 객체의 단위이다.
- 하나의 프로세스에는 반드시 1개 이상의 스레드가 존재하며 이러한 스레드는 같은 프로세스에 있는 자원과 상태를 공유한다.
- 같은 프로세스 내에 있는 스레드는 같은 주소 공간에 존재하며 동일한 데이터에 접근할 수 있다.
- 하나의 스레드가 수정한 메모리는 같은 메모리를 참조하는 스레드에 영향을 미치게 된다.
- 하나의 스레드에서 오픈한 파일을 다른 스레드가 사용할 수 있으며 프로세스가 종료되면 스레드도 함께 종료된다.

### 스레드의 필요성

- 하나의 프로세스 안에서 여러 개의 루틴을 동시에 수행하여 수행 능력을 향상하려고 할 때 스레드를 사용하며, 독립적으로 수행하여 처리하려고 할 때 사용한다.
- 여러 개의 작업 단위로 구성된 프로그램에서 요청을 동시에 처리하기 위함이다.
- 키보드 입력을 받거나 , 여러 요청들을 동시에 처리해야 할 때 스레드가 필요하다.

### 스레드의 구성 요소

- 가상 CPU : 인터프리터, 컴파일러에 의해 내부적으로 처리되는 가상 코드
- 수행 코드 : Thread Class에 구현되어 있는 run() Method 코드
- 처리 데이터 : Thread에서 처리하는 데이터

### 스레드의 특징

- 프로세스 내에서 실행되는 흐름의 단위이다.
- 하나의 스레드는 시작해서 종료할 때까지 한 번에 하나씩 명령을 수행한다.
- 각 스레드마다 call stack이 존재하며, 나머지 COde,Data,Heap 영역은 스레드끼리 공유한다.
- 프로세스는 다른 프로세스의 메모리에 직접 접근할 수 없다.
- 스레드는 다른 스레드와 독립적으로 동작한다.
- 독립적으로 동작하기 때문에 두 개 이상의 스레드가 동작되는 경우, 두 개 이상의 스레드의 실행 및 종료 순서는 예측할 수 없다.

### 싱글 스레드와 멀티 스레드

![image](https://user-images.githubusercontent.com/118104644/227860418-24a292c1-c044-455a-8740-08ac46c0cfd0.png){:.center}

#### 싱글 스레드

- 프로세스가 단일 스레드로 동작하는 방식으로 일련의 처리를 단일 스레드만으로 직렬 처리하는 프로그래밍 방법이다.
- 하나의 레지스터, 스택으로 표현한다.
- 자바스크립트가 가장 대표적인 싱글 스레드 언어이다.

##### 싱글 스레드의 장점

- 자원 접근에 대한 동기화를 신경쓰지 않아도 된다.
  - 모든 스레드가 일정 자원에 동시에 접근하면 에러가 발생하거나 원하는 값이 나오지 않아, 동시에 접근할 수 없도록 제어해줘야 한다.
- 자원 접근에 대한 동기화를 신경쓰지 않아도 되기 때문에 많은 비용이 발생하는 문맥 교환을 하지 않아도 된다.
- 프로그래밍 난이도가 쉽고, CPU 메모리를 적게 사용한다.

##### 싱글 스레드의 단점

- 여러 개의 CPU를 활용하지 못한다.
  - 하나의 물리적 코어밖에 사용하지 못해 멀티 코어 머신에서 CPU 사용을 최적화할 수 없다.
  - 최적화를 위해선 Cluster 모듈을 이용하여 프로세스를 사용할 수 있다.
- 연산량이 많은 작업을 하는 경우, 작업이 완료되어야 다른 작업을 수행할 수 있다.
- 싱글 스레드 모델은 에러 처리를 못하는 경우 멈춰버리게 되며, 멀티 스레드 모델은 에러 발생 시 새로운 스레드를 생성하여 극복할 수 있다.

#### 멀티 스레드

- 하나의 프로세스 내에서 둘 이상의 스레드가 동시에 작업을 수행하는 것을 의미한다.
- 여러 개의 CPU를 사용하여 여러 프로세스를 동시에 수행하는 것을 의미한다.
- 시스템 자원의 활용 극대화 및 처리량 증대할 수 있어 단일 프로세스 시스템의 효율성을 높일 수 있다.

##### 멀티 스레딩의 장점

- 싱글 스레드인 경우, 작업이 끝나기 전까지 사용자에게 응답하지 않지만, 멀티스레드인 경우 작업을 분리해서 수행하므로 실시간으로 사용자에게 응답할 수 있다.
- 싱글 스레드인 경우 한 프로세스는 오직 한 프로세서에서만 수행 가능하지만 멀티 스레드인 경우 한 프로세스를 여러 프로세서에서 수행할 수 있으므로 훨씬 효율적이다.

##### 멀티 스레딩의 문제점

- 주의 깊은 설계가 필요하며 디버깅이 까다롭다.
- 단일 프로세스 시스템의 경우 효과를 기대하기 어려우며 다른 프로세스에서 스레드를 제어할 수 없다.
- 멀티 스레드의 경우 자원 공유의 문제가 발생하기 때문에 문제가 발생하면 전체 프로세스가 영향을 받게 된다.
- 문맥 교환 작업을 요구하여 CPU에서 여러 프로세스를 돌아가면서 작업을 처리하는 데 이 과정을 문맥 교환이라고 한다.

##### 동시성과 병렬성의 차이

![image](https://user-images.githubusercontent.com/118104644/227885340-51d38b5d-62be-4faf-a594-0637f5a364fa.png){:.center}

- 동시에 돌릴 수 있는 스레드 수는 컴퓨터에 있는 코어 개수로 제한된다.
- 운영 체제는 각 스레드를 시간에 따라 분할하여 여러 스레드가 일정 시간마다 돌아가면서 실행되도록 한다.
- 이런 방식을 시분할이라고 한다.
