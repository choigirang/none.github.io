---
title:  "React 27장 - 로그인 구현하기(1)"
excerpt: "Cookie와 서버"

categories: React
tags: [React, 리액트, 컴포넌트, JSX, 상태관리, Cookie, server]

toc: true
toc_sticky: true
 
date: 2023-03-07
last_modified_at: 2023-03-07
---
# React
## 자료구조
- **client**
  - ...
  - **pages**
    - Login.js
    - Mypage.js
  - **src**
    - App.js
    - index.js
- **server**
  - **controllers**
    - **users**
      - login.js
      - logout.js
      - userInfo.js
    - index.js
  - **db**
    - data.js
  - index.js

### 서버 만들기
#### server/index.js
```jsx
const express = require('express');
const cors = require('cors');
const logger = require('morgan');
const cookieParser = require('cookie-parser');
const fs = require('fs');
const https = require('https');
const controllers = require('./controllers');
const app = require();

process.env.NODE_TLS_REJECT_UNAUTHORIZED = "0";

const HTTPS_PORT = process.env.HTTPS_PORT || 4000;

app.use(logger('dev'));
app.use(express.json());
app.use(express.urlencoder({extended: false }));
app.use(cookieParser());

const corsOptions = {
    origin: "http://localhost:3000",
    credentials: true,
    methods: ['GET', 'POST', 'OPTION'],

};

app.use(cors(corsOptions));

app.post('/login', controllers.login);
app.post('/logout', controllers.logout);
app.get('/userInfo', controllers.userInfo);

let server;
if(fs.existsSync('./key.pem') && fs.existsSync('./cert.pem')){
    const privateKey = fs.readFileSync(__dirname + '/key.pem','utf8');
    const certificate = fs.readFileSync(__dirname + '/cert.pem','utf8');
    const credentials = {
        key: privateKey,
        cert: certificate,
    }

    server = https.createServer(credentials, app);
    server.listen( HTTPS_PORT, () =>
        console.log(`HTTPS Server is starting on ${HTTPS_PORT}`));
}else{
    server = app.listen( HTTPS_PORT, () =>
        console.log(`HTTP Server is starting on ${HTTP_PORT}`));
}
module.exports = server;
```

- `{express, cors, logger, cookieParser, fs, https}` 모듈을 사용한다.
  - **express**
    - Node.js 기반의 서버를 만드는 데 사용한다.
    - HTTP 요청 및 응답 처리를 위한 다양한 기능을 제공한다.
  - **CORS (Cross-Origin Resource Sharing)**
    - 다른 도메인의 리소스를 요청하는 것을 제한한다.
    - 다른 도메인의 리소스에 대한 접근을 허용하도록 설정할 수 있다.
  - **Logger**
    - 서버에서 발생하는 로그를 기록하고 분석한다.
    - 서버의 문제를 파악하고 해결하는 데 도움이 된다.
  - **CookieParse**
    - HTTP 요청에서 쿠키를 파싱하고, 요청 객체의 cookie 속성에 쿠키 정보를 저장한다.
    - 서버에서 쿠키를 쉽게 다룰 수 있다.
  - **fs(File System)**
    - Node.js의 내장 모듈 중 하나로, 파일 시스템에 접근하여 파일을 읽거나 쓰는 등의 작업을 수행한다.
    - 파일 시스템을 다루는 작업에서 유용하게 사용한다.
  - **HTTPS**
    - HTTP 프로토콜을 보안한 버전으로 모듈로 사용할 수 있다.
- `process.env.NODE_TLS_REJECT_UNAUTHORIZED = "0"`
  - HTTPS 프로토콜을 사용할 때 SSL 인증서의 유효성 검사를 비활성한다.
  - 서버와 클라이언트 간의 통신을 암호화하고 보안을 강화하는 역할을 한다.
  - SSL 인증서의 유효성 검사를 비활성화하면 HTTPS 프로토콜을 사용할 수 있다.
  - 보안성을 고려하여 개발 환경에서만 사용하고 실제 서비스에서는 인증서 검증을 비활성화 하지 않도록 주의해야 한다.
- `const HTTPS_PORT = process.env.HTTPS_PORT || 4000`
  - HTTPS 프로토콜을 사용할 포트 번호를 지정한다.
  - 환경 변수로 HTTPS_PORT가 정의되어 있으면 그 값을 변수에 할당하고, 그렇지 않으면 4000을 할당한다.
- `app.use()`
  - Express 애플리케이션 객체에 미들웨어 함수를 등록하는 메서드이다.
  - 따라서, 객체에 등록된 미들웨어 함수는 애플리케이션에서 발생하는 모든 요청에 대해 실행된다.
    - `logger("dev")` : 개발 시 로깅을 위한 미들웨어 함수
    - `express.json()` : 클라이언트로부터 전송된 JSON 형태의 데이터를 파싱하기 위한 미들웨어 함수
    - `express.urlencoded({extended:false})` : 클라이언트로부터 전송된 URL-encoded 데이터를 파싱하기 위한 미들웨어 함수
    - `cookieParser()` : 클라이언트로부터 전송된 쿠키를 파싱하기 위한 미들웨어 함수
    - `cors(corsOptions)` : CORS를 허용하기 위한 미들웨어 함수, `corsOptions`는 옵션 객체로 클라이언트 도메인, 메서드, 쿠키 등을 설정한다.
- `credentials`
  - 서버에 대한 인증서와 키를 저장하는 객체이다.
  - 인증서는 클라이언트가 서버와 통신할 때, 서버가 신뢰할 수 있는지 확인할 수 있다.
- `app.post`
  - Express 애플리케이션 객체에 HTTP POST 요청을 처리한다.
  - `cotrollsers`로 정의된 모듈을 불러와서 POST 요청을 처리한다.
- 